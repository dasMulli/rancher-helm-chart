#{{-  $url := printf "%s%s" "http://influxdb." .Values.panda.zooUrl -}}

{{- define "panda-grafana-datasources-content" }}
apiVersion: 1
datasources:
  - name: PANDA
    type: influxdb
    org_id: 1
    url: http://influxdb.{{ .Values.panda.zooUrl }}
    password: admin
    user: admin
    database: panda
    basicAuth: true
    basicAuthUser: admin
    withCredentials: true
    isDefault: true
    editable: false
    secureJsonData: {
      basicAuthPassword: "admin"
    }
{{- end }}

#apiVersion: v1
#kind: ConfigMap
#metadata:
#  namespace: {{.Release.Namespace}}
#  name: panda-influx-secret
#type: Opaque
#data:
#  name: {{ "PANDA" | b64enc }}
#  url: {{ $url | b64enc }}
#  type: {{ "InfluxDB" | b64enc }}
#  password: {{ "admin" | b64enc }}
#  user: {{ "admin" | b64enc }}
#  database: {{ "panda" | b64enc }}
#  basicAuth: {{ "true" | b64enc }}
#  basicAuthUser: {{ "admin" | b64enc }}
#  basicAuthPassword: {{ "admin" | b64enc }}
#  withCredentials: {{ "true" | b64enc }}
#  isDefault: {{ "true" | b64enc }}
#  editable: {{ "false" | b64enc }}


# Source: mychart/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: {{.Release.Namespace}}
  name: panda-grafana-datasources
data:
apiVersion: v1
data:
  datasources.yaml: {{ (include "panda-grafana-datasources-content" .) | trim | quote }}




apiVersion: v1
kind: Pod
metadata:
  name: configmap-demo-pod
spec:
  containers:
    - name: demo
      image: game.example/demo-game
      env:
        # Define the environment variable
        - name: PLAYER_INITIAL_LIVES # Notice that the case is different here
                                     # from the key name in the ConfigMap.
          valueFrom:
            configMapKeyRef:
              name: game-demo           # The ConfigMap this value comes from.
              key: player_initial_lives # The key to fetch.
        - name: UI_PROPERTIES_FILE_NAME
          valueFrom:
            configMapKeyRef:
              name: game-demo
              key: ui_properties_file_name
      volumeMounts:
      - name: config
        mountPath: "/config"
        readOnly: true
  volumes:
    # You set volumes at the Pod level, then mount them into containers inside that Pod
    - name: config
      configMap:
        # Provide the name of the ConfigMap you want to mount.
        name: game-demo